let testData = [

  {"basePoint":[98,98],"dataPoint":43,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[110,110],"dataPoint":44,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[ 121, 121 ],"dataPoint":45,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[301,302],"dataPoint":91,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"dataPoint":92,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[308,308],"dataPoint":93,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[315,316],"dataPoint":98,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"dataPoint":99,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[317,317],"dataPoint":100,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[343,343],"dataPoint":111,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[346,347],"dataPoint":112,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},{"basePoint":[347,348],"dataPoint":113,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[407,407],"dataPoint":129,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[410,410],"dataPoint":130,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[470,470],"dataPoint":156,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[472,472],"dataPoint":157,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[473,473],"dataPoint":158,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[474,474],"dataPoint":159,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[474,475],"dataPoint":160,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[477,477],"dataPoint":161,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[481,482],"dataPoint":162,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[674,675],"dataPoint":263,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[679,679],"dataPoint":264,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[682,682],"dataPoint":265,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[690,690],"dataPoint":274,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[ 692, 692 ],"dataPoint":275,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[693,693],"dataPoint":276,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[ 963, 963 ],"dataPoint":404,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"basePoint":[ 971, 971 ],"dataPoint":405,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},
  {"dataPoint":406,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/851/"}},

  {"basePoint":[ 93, 93 ],"dataPoint":53,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/852/"}},
  {"dataPoint":55,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/852/"}},
  {"basePoint":[ 132, 132 ],"dataPoint":56,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/852/"}},
  {"basePoint":[ 681, 682 ],"dataPoint":299,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/852/"}},
  {"basePoint":[ 684, 684 ],"dataPoint":300,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/852/"}},
  {"basePoint":[ 687, 687 ],"dataPoint":301,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/852/"}},

  {"basePoint":[ 477, 477 ],"dataPoint":178,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/854/"}},

  {"dataPoint":18,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/855/"}},
  {"basePoint":[0,0],"dataPointSource":"resultStart","in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/855/"}},
  {"basePoint":[2,2],"dataPoint":19,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/855/"}},
  {"basePoint":[4,4],"dataPoint":20,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/855/"}},
  {"basePoint":[ 781, 781 ],"dataPoint":315,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/855/"}},
  {"basePoint":[ 787, 787 ],"dataPoint":316,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/855/"}},
  {"dataPoint":319,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/855/"}},
  {"basePoint":[ 795, 796 ],"dataPoint":320,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/855/"}},
  {"basePoint":[ 798, 798 ],"dataPoint":321,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/855/"}},
  {"basePoint":[ 971, 971 ],"dataPoint":401,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/855/"}},


  {"basePoint":[ 90, 91 ],"dataPoint":57,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/859/"}},
  {"basePoint":[ 94, 94 ],"dataPoint":58,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/859/"}},
  {"basePoint":[ 104, 107 ],"dataPoint":59,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/859/"}},
  {"basePoint":[ 125, 125 ],"dataPoint":60,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/859/"}},
  {"basePoint":[ 324, 325 ],"dataPoint":126,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/859/"}},
  {"basePoint":[ 339, 339 ],"dataPoint":127,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/859/"}},
  {"basePoint":[ 347, 347 ],"dataPoint":133,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/859/"}},
  {"basePoint":[775,776],"dataPoint":330,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/859/"}},
  {"basePoint":[777,777],"dataPoint":332,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/859/"}},
  {"basePoint":[779,780],"dataPoint":333,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/859/"}},
  {"basePoint":[782,782],"dataPoint":334,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/859/"}},
  {"basePoint":[ 971, 971 ],"dataPoint":425,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/859/"}},

  {"basePoint":[0,0],"dataPointSource":"resultStart","in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/858/"}},
  {"basePoint":[2,2],"dataPoint":32,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/858/"}},
  {"basePoint":[78,78],"dataPoint":52,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/858/"}},
  {"basePoint":[152,152],"dataPoint":53,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/858/"}},
  {"basePoint":[176,176],"dataPoint":58,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/858/"}},
  {"basePoint":[176,176],"dataPoint":58,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/858/"}},
  {"basePoint":[194,194],"dataPoint":59,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/858/"}},
  {"basePoint":[426,427],"dataPoint":139,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/858/"}},
  {"dataPoint":140,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/858/"}},
  {"basePoint":[442,442],"dataPoint":141,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/858/"}},
  {"basePoint":[958,958],"dataPoint":389,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/858/"}},
  {"basePoint":[969,969],"dataPoint":390,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/858/"}},
  {"basePoint":[970,970],"dataPoint":391,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/858/"}},

  {"basePoint":[722,723],"dataPoint":303,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/609/"}},
  {"dataPoint":304,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/609/"}},
  {"basePoint":[726,726],"dataPoint":306,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/609/"}},
  {"basePoint":[971,971],"dataPoint":422,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/609/"}},

  {"basePoint":[723,724],"dataPoint":242,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/640/"}},
  {"dataPoint":243,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/640/"}},
  {"basePoint":[728,729],"dataPoint":245,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/640/"}},{"basePoint":[970,970],"dataPoint":335,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/640/"}},

  {"basePoint":[730,731],"dataPoint":275,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/661/"}},
  {"dataPoint":276,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/661/"}},
  {"basePoint":[740,741],"dataPoint":278,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/661/"}},
  {"basePoint":[971,971],"dataPoint":371,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/661/"}},

  {"basePoint":[91,91],"dataPoint":66,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/668/"}},
  {"basePoint":[107,107],"dataPoint":67,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/668/"}},
  {"basePoint":[117,117],"dataPoint":68,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/668/"}},
  {"basePoint":[316,317],"dataPoint":141,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/668/"}},
  {"dataPoint":150,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/668/"}},
  {"dataPoint":152,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/668/"}},
  {"dataPoint":153,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/668/"}},

  {"basePoint":[736,736],"dataPoint":280,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/610/"}},
  {"dataPoint":281,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/610/"}},
  {"dataPoint":282,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/610/"}},{"basePoint":[736,737],"dataPoint":283,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/610/"}},
  {"basePoint":[970,970],"dataPoint":377,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/610/"}},

  {"basePoint":[333,333],"dataPoint":142,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/675/"}},
  {"basePoint":[343,343],"dataPoint":146,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/675/"}},
  {"dataPoint":147,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/675/"}},
  {"dataPoint":189,"in":{"radius":100,"url0":"/ev/8963707529176734833/","url1":"t/675/"}},

  {"basePoint":[917,918],"dataPoint":105,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/47/"}},
  {"basePoint":[951,951],"dataPoint":106,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/47/"}},
  {"basePoint":[960,960],"dataPoint":107,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/47/"}},
  {"basePoint":[984,984],"dataPoint":108,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/47/"}},
  {"basePoint":[2509,2509],"dataPoint":295,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/47/"}},

  {"basePoint":[919,919],"dataPoint":102,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/3/"}},
  {"basePoint":[2372,2372],"dataPoint":291,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/3/"}},
  {"basePoint":[2375,2375],"dataPoint":292,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/3/"}},
  {"basePoint":[2376,2376],"dataPoint":293,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/3/"}},
  {"basePoint":[2385,2386],"dataPoint":297,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/3/"}},
  {"basePoint":[2519,2519],"dataPoint":317,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/3/"}},

  {"basePoint":[0,0],"dataPointSource":"resultStart","in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/4/"}},
  {"basePoint":[392,392],"dataPoint":43,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/4/"}},
  {"dataPoint":44,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/4/"}},
  {"basePoint":[397,397],"dataPoint":46,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/4/"}},
  {"basePoint":[1142,1142],"dataPoint":133,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/4/"}},
  {"dataPoint":143,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/4/"}},

  {"basePoint":[916,916],"dataPoint":112,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/43/"}},
  {"basePoint":[2286,2286],"dataPoint":325,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/43/"}},
  {"dataPoint":326,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/43/"}},

  {"basePoint":[2427,2427],"dataPoint":256,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/29/"}},
  {"basePoint":[2475,2476],"dataPoint":260,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/29/"}},
  {"basePoint":[2484,2484],"dataPoint":261,"in":{"radius":100,"url0":"/ev/8963798851958479327/","url1":"t/29/"}},

  {"basePoint":[0,0],"dataPointSource":"resultStart","in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/436/"}},
  {"basePoint":[4,4],"dataPoint":11,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/436/"}},
  {"basePoint":[687,687],"dataPoint":62,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/436/"}},
  {"basePoint":[1453,1453],"dataPoint":110,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/436/"}},
  {"basePoint":[3101,3101],"dataPoint":188,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/436/"}},
  {"basePoint":[4981,4981],"dataPoint":346,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/436/"}},
  {"basePoint":[8846,8846],"dataPoint":723,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/436/"}},
  {"basePoint":[8851,8851],"dataPoint":724,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/436/"}},

  {"basePoint":[4656,4656],"dataPoint":356,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/377/"}},
  {"basePoint":[4764,4764],"dataPoint":360,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/377/"}},
  {"basePoint":[8851,8851],"dataPoint":717,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/377/"}},

  {"basePoint":[521,521],"dataPoint":57,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/370/"}},
  {"basePoint":[910,910],"dataPoint":58,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/370/"}},
  {"basePoint":[4021,4021],"dataPoint":189,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/370/"}},
  //{"basePoint":[4058,4058],"dataPoint":190,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/370/"}},
  //{"basePoint":[4077,4077],"dataPoint":191,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/370/"}},
  {"basePoint":[4095,4095],"dataPoint":197,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/370/"}},
  {"basePoint":[8843,8843],"dataPoint":564,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/370/"}},

  {"basePoint":[4021,4021],"dataPoint":319,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[1046,1046],"dataPoint":99,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[1062,1062],"dataPoint":100,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[1928,1928],"dataPoint":171,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[1955,1955],"dataPoint":172,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[1958,1958],"dataPoint":173,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[2610,2610],"dataPoint":218,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[2634,2634],"dataPoint":219,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[2664,2664],"dataPoint":220,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[2668,2668],"dataPoint":221,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[2679,2679],"dataPoint":222,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[3452,3452],"dataPoint":275,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[3465,3465],"dataPoint":276,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[3491,3491],"dataPoint":277,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[3491,3491],"dataPoint":277,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[3507,3507],"dataPoint":279,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[3998,3998],"dataPoint":316,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  //{"basePoint":[4052,4052],"dataPoint":317,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  //{"basePoint":[4069,4069],"dataPoint":318,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  //{"basePoint":[4081,4081],"dataPoint":319,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[4090,4090],"dataPoint":323,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[4103,4103],"dataPoint":324,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[4113,4113],"dataPoint":325,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  {"basePoint":[4578,4578],"dataPoint":396,"in":{"radius":100,"url0":"/ev/8963798851961273924/","url1":"t/489/"}},
  
];

{
  let testCount = 0;
  let failed = [];
  
  function ok () {
    process.stdout.write ("ok " + ++testCount + "\n");
  }

  function ng (j, actual, xActual, expected0, expected1, xExpected0, xExpected1) {
    process.stdout.write ("not ok " + ++testCount + " # ["+j+"] Got "+actual+" {"+xActual+"}, expected: ["+xExpected0+" {"+expected0+"}, "+xExpected1+" {"+expected1+"}]\n");
    failed.push (testCount);
  }

  function test_done () {
    process.stdout.write ("1.." + testCount + "\n");
    if (failed.length) {
      process.stdout.write ("Failed: " + failed.join (', ') + "\n");
    }
  }
}

let tests = [];
testData.forEach (t => {
  let baseRouteURL = new URL (t.in.url0, "https://ibuki.run/");
  let dataRouteURL = new URL (t.in.url1, baseRouteURL);
  let key = baseRouteURL + "\x00" + t.in.radius;
  if (!tests[key]) {
    tests[key] = {baseRouteURL, radius: t.in.radius, checks: {}};
  }
  if (!tests[key].checks[dataRouteURL]) {
    tests[key].checks[dataRouteURL] = {dataRouteURL, checks: []};
  }
  tests[key].checks[dataRouteURL].checks.push ({
    basePoint: t.basePoint,
    dataPoint: t.dataPoint, dataPointSource: t.dataPointSource,
  });
});

Promise.all ([
  require ('../src/routes.js'),
  require ('../src/loader.js'),
]).then (async ([routes, loader]) => {
  for (let key in tests) {
    let test1 = tests[key];
    let ib0 = await loader.fetchIbuki (test1.baseRouteURL);
    let pointsList = [];
    pointsList[0] = ib0.routePoints;
    let computed = {elapsed: {}};
    routes.computeBase (pointsList, test1.radius, computed);
    for (let test2 of Object.values (test1.checks)) {
      let ib1 = await loader.fetchIbuki (test2.dataRouteURL);
      pointsList[1] = ib1.routePoints;
      pointsList[2] = ib1.forcedPoints;
      routes.computeData (pointsList, computed);

      process.stdout.write ("# " + test1.baseRouteURL + "\n");
      process.stdout.write ("# " + test2.dataRouteURL + "\n");

      for (let check of test2.checks) {
        if (check.dataPoint != null) {
          let j = pointsList[1][check.dataPoint].index;
          let d2b = computed.dataToBase[j] || {};
          let actual = d2b.effectiveIndex;
          if (check.basePoint) {
            if (actual == null) {
              ng (j, actual, null,
                  check.basePoint[0], check.basePoint[1],
                  pointsList[0][check.basePoint[0]].index,
                  pointsList[0][check.basePoint[1]].index);
            } else {
              if (pointsList[0][check.basePoint[0]].index <= actual &&
                  actual <= pointsList[0][check.basePoint[1]].index) {
                ok ();
              } else {
                ng (j, actual, 
                    computed.basePoints[actual].origIndex,
                    check.basePoint[0], check.basePoint[1],
                    pointsList[0][check.basePoint[0]].index,
                    pointsList[0][check.basePoint[1]].index);
              }
            }
          } else {
            if (actual == null) {
              ok ();
            } else {
              ng (j, actual, computed.basePoints[actual].origIndex,
                  null, null, null, null);
            }
          }
        } else if (check.basePoint &&
                   check.basePoint[0] === check.basePoint[1]) {
          let bp = computed.basePoints[pointsList[0][check.basePoint[0]].index];
          let d2b;
          for (let link of computed.dataToBase) {
            if (link && link.effectiveIndex === bp.index) {
              d2b = link;
              break;
            }
          }
          if (d2b && d2b.forced === check.dataPointSource) {
            ok ();
          } else {
            ng (j, d2b ? d2b.forced : null,
                d2b ? computed.basePoints[d2b.forced].origIndex : null,
                check.basePoint[0], check.basePoint[1],
                pointsList[0][check.basePoint[0]].index,
                pointsList[0][check.basePoint[1]].index);
          }
        } else {
          console.log (check);
          throw new Error ("Broken test");
        }
      } // check
    }
  } // test
}).then (() => test_done ());

/*
  
Copyright 2024 Wakaba <wakaba@suikawiki.org>.

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Affero General Public License for more details.

You does not have received a copy of the GNU Affero General Public
License along with this program, see <https://www.gnu.org/licenses/>.

*/
